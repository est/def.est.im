---
import BaseLayout from '../layouts/BaseLayout.astro';
import WordCard from '../components/WordCard.astro';
import MeaningsSection from '../components/MeaningsSection.astro';

export const prerender = false; // This is an SSR page, not prerendered

const { word } = Astro.params;

// Try to load from cached JSON first
let wordData = null;
try {
  const response = await fetch(`${Astro.site}/.dict_json/out/${word}.json`);
  if (response.ok) {
    wordData = await response.json();
  }
} catch (error) {
  console.log('No cached data found for:', word);
}

// If no cached data, we'll let the client-side handle the lookup
if (!wordData) {
  wordData = {
    WORD: word,
    IPA: '',
    CONJUGATES: '',
    ETYMOLOGY: '',
    SINCE: '',
    MEANINGS: [],
    REGISTER: ''
  };
}
---

<BaseLayout title={`${word} - def.est.im`} word={word} wordData={wordData}>
  <WordCard 
    word={wordData.WORD}
    ipa={wordData.IPA}
    conjugates={wordData.CONJUGATES}
    etymology={wordData.ETYMOLOGY}
    since={wordData.SINCE}
    register={wordData.REGISTER}
  />

  <main class="main">
    <MeaningsSection meanings={wordData.MEANINGS} />

    <section>
      <h2>使用</h2>
      <div style="color:var(--muted);line-height:1.6">
        <p><strong>Register:</strong> <span x-text="REGISTER">{wordData.REGISTER}</span></p>
      </div>
    </section>

    <section>
      <h2>注意</h2>
      <div style="color:var(--muted);line-height:1.6">
        <p>本词典由AI撰写。仅供参考。 <a href="https://github.com/est/def.est.im">Github</a> | <a href="https://blog.est.im/2025/stdout-12">Blog</a></p>
      </div>
    </section>
  </main>
</BaseLayout>
